<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyPDF - 29+ Free PDF Tools with 3D Flipbook & Dark Mode</title>
    <meta name="description" content="The ultimate suite of 29+ free online PDF tools. Features a unique 3D PDF Flipbook viewer, PDF to GIF converter, dark mode, and 100% client-side processing for total privacy.">
    <meta name="keywords" content="PDF, tools, 3D PDF Flipbook, PDF to GIF, dark mode, convert PDF, edit PDF, sign PDF, free, online, secure, website traffic, fascinating tools">

    <!-- Google Search Console Verification (placeholder) -->
    <!-- <meta name="google-site-verification" content="YOUR_VERIFICATION_CODE" /> -->

    <!-- External Libraries (via CDN) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/pdfjs-dist@2.16.105/build/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pptxgenjs/3.12.0/pptxgen.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/3d-flip-book@1.0.12/dist/3d-flip-book.min.js"></script>


    <style>
        :root {
            --primary-blue: #0d6efd;
            --primary-blue-dark: #0b5ed7;
            --background-light: #f8f9fa;
            --background-white: #ffffff;
            --text-dark: #212529;
            --text-light: #6c757d;
            --border-color: #dee2e6;
            --max-width: 1200px;
            --border-radius: 12px;
            --box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            --box-shadow-hover: 0 12px 40px rgba(0, 0, 0, 0.12);
            --gradient-start: #e0f7ff;
            --gradient-end: #ffffff;
        }

        [data-theme="dark"] {
            --primary-blue: #4dabf7;
            --primary-blue-dark: #339af0;
            --background-light: #121212;
            --background-white: #1e1e1e;
            --text-dark: #e0e0e0;
            --text-light: #a0a0a0;
            --border-color: #333;
            --box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
            --box-shadow-hover: 0 12px 40px rgba(0, 0, 0, 0.6);
            --gradient-start: #1c2b4d;
            --gradient-end: #121212;
        }

        /* Base & Accessibility */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--background-light);
            color: var(--text-dark);
            line-height: 1.7;
            font-size: 16px;
            transition: background-color 0.3s, color 0.3s;
        }
        .container { max-width: var(--max-width); margin: 0 auto; padding: 0 20px; }
        h1, h2, h3 { font-weight: 700; }

        /* Header & Navigation */
        .header {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 15px 0;
            position: sticky;
            top: 0;
            width: 100%;
            z-index: 1000;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.3s, border-color 0.3s;
        }
        [data-theme="dark"] .header {
            background-color: rgba(30, 30, 30, 0.8);
        }
        .navbar { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.8rem; font-weight: 800; color: var(--primary-blue); text-decoration: none; }
        .nav-menu { display: flex; list-style: none; gap: 20px; align-items: center; }
        .nav-link { text-decoration: none; color: var(--text-dark); font-weight: 500; transition: color 0.3s; }
        .nav-link:hover { color: var(--primary-blue); }
        
        /* Dark Mode Toggle */
        .theme-switch-wrapper { display: flex; align-items: center; }
        .theme-switch { display: inline-block; height: 24px; position: relative; width: 48px; }
        .theme-switch input { display:none; }
        .slider { background-color: #ccc; bottom: 0; cursor: pointer; left: 0; position: absolute; right: 0; top: 0; transition: .4s; border-radius: 24px; }
        .slider:before { background-color: #fff; bottom: 4px; content: ""; height: 16px; left: 4px; position: absolute; transition: .4s; width: 16px; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary-blue); }
        input:checked + .slider:before { transform: translateX(24px); }

        /* Hero Section */
        .hero {
            text-align: center;
            padding: 120px 20px;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            position: relative;
            overflow: hidden;
            transition: background 0.3s;
        }
        .hero h1 { font-size: 3.5rem; margin-bottom: 20px; font-weight: 800; }
        .hero p { font-size: 1.25rem; color: var(--text-light); max-width: 700px; margin: 0 auto 30px auto; }
        .hero .cta-button {
            background: var(--primary-blue);
            color: white;
            padding: 16px 32px;
            text-decoration: none;
            border-radius: 50px;
            font-weight: bold;
            display: inline-block;
            transition: transform 0.2s ease, background-color 0.3s;
            box-shadow: 0 10px 20px rgba(13, 110, 253, 0.2);
        }
        .hero .cta-button:hover { transform: translateY(-3px); background-color: var(--primary-blue-dark); }

        /* Tools Grid */
        main { padding: 40px 0; }
        #tools-grid { display: grid; gap: 30px; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); }
        .tool-card {
            background-color: var(--background-white);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            text-align: center;
            cursor: pointer;
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s, background-color 0.3s;
            position: relative;
            overflow: hidden;
        }
        .tool-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--box-shadow-hover);
            border-color: var(--primary-blue);
        }
        .tool-card .icon-wrapper {
            width: 64px;
            height: 64px;
            margin: 0 auto 20px auto;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--icon-bg-color, #e7f0fe);
            transition: background-color 0.3s;
        }
        .tool-card .icon { width: 32px; height: 32px; }
        .tool-card .icon svg { color: var(--icon-color, var(--primary-blue)); }
        .tool-card h3 { font-size: 1.25rem; margin-bottom: 10px; }
        .tool-card p { font-size: 0.95rem; color: var(--text-light); }
        .tool-card .new-badge { position: absolute; top: 10px; right: -30px; background: var(--primary-blue); color: white; padding: 2px 30px; font-size: 0.8rem; transform: rotate(45deg); }

        /* Modal - FIXED & ENHANCED */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0, 0, 0, 0.6); animation: fadeIn 0.3s ease; }
        .modal-content-wrapper { display: flex; align-items: center; justify-content: center; min-height: 100%; padding: 20px; }
        .modal-content { background-color: var(--background-white); border-radius: var(--border-radius); box-shadow: 0 10px 30px rgba(0,0,0,0.2); width: 100%; max-width: 800px; animation: slideIn 0.4s ease-out; position: relative; display: flex; }
        .modal-main { flex-grow: 1; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 30px; border-bottom: 1px solid var(--border-color); background-color: var(--background-light); border-top-left-radius: var(--border-radius); border-top-right-radius: var(--border-radius); }
        .modal-header h2 { font-size: 1.5rem; color: var(--primary-blue); }
        .close-button { background: none; border: none; font-size: 1.8rem; color: var(--text-light); cursor: pointer; transition: color 0.2s; }
        .close-button:hover { color: var(--text-dark); }
        .modal-body { padding: 30px; }
        .file-input { width: 0.1px; height: 0.1px; opacity: 0; overflow: hidden; position: absolute; z-index: -1; }
        .file-drop-area { border: 3px dashed var(--border-color); border-radius: var(--border-radius); padding: 40px; text-align: center; transition: background-color 0.3s, border-color 0.3s; cursor: pointer; }
        .file-drop-area.dragover { background-color: #e7f0fe; border-color: var(--primary-blue); }
        .file-drop-area h3 { margin-bottom: 10px; }
        .file-drop-area p { color: var(--text-light); margin-bottom: 15px; }
        .file-label-button { background-color: var(--primary-blue); color: white; padding: 12px 25px; border-radius: 50px; cursor: pointer; display: inline-block; transition: background-color 0.3s; font-weight: 500; }
        .file-label-button:hover { background-color: var(--primary-blue-dark); }
        .file-list { list-style: none; margin-top: 20px; }
        .file-list li { background: var(--background-light); padding: 10px 15px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem; }
        .remove-file-btn { background: none; border: none; color: #dc3545; font-weight: bold; cursor: pointer; font-size: 1.2rem; }
        .tool-options { margin: 20px 0; }
        .tool-options label { display: block; margin-bottom: 8px; font-weight: 500; }
        .tool-options input, .tool-options select { width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--background-white); color: var(--text-dark); }
        .process-button { width: 100%; padding: 15px; font-size: 1.2rem; font-weight: 600; background-color: var(--primary-blue); color: white; border: none; border-radius: 50px; cursor: pointer; transition: background-color 0.3s, transform 0.2s; margin-top: 20px; }
        .process-button:disabled { background-color: #ccc; cursor: not-allowed; }
        .process-button:not(:disabled):hover { background-color: var(--primary-blue-dark); transform: translateY(-2px); }
        #output-area { margin-top: 20px; }
        .download-link { display: inline-block; background: #198754; color: white; padding: 10px 20px; text-decoration: none; border-radius: 50px; }
        
        /* Loader */
        .loader-overlay { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.8); z-index: 10; justify-content: center; align-items: center; flex-direction: column; border-radius: var(--border-radius); }
        [data-theme="dark"] .loader-overlay { background: rgba(30, 30, 30, 0.8); }
        .spinner { width: 60px; height: 60px; border: 6px solid var(--border-color); border-top-color: var(--primary-blue); border-radius: 50%; animation: spin 1s linear infinite; }
        #loader-text { margin-top: 20px; font-weight: 500; font-size: 1.1rem; color: var(--text-light); }
        
        /* Other styles */
        .ad-placeholder { border: 2px dashed var(--border-color); display: flex; justify-content: center; align-items: center; color: var(--text-light); background-color: var(--background-white); font-size: 0.9rem; margin: 40px auto; }
        .ad-banner-top { width: 728px; height: 90px; }
        .ad-in-article { max-width: 100%; height: 250px; }
        .ad-sidebar-modal { width: 160px; height: 600px; flex-shrink: 0; margin-left: 20px; }
        #about-section { background: var(--background-white); padding: 60px 0; margin-top: 60px; transition: background-color 0.3s; }
        #about-section .container { max-width: 800px; }
        #about-section h2 { text-align: center; font-size: 2.5rem; margin-bottom: 40px; color: var(--primary-blue); }
        #about-section h3 { font-size: 1.8rem; margin-top: 40px; margin-bottom: 20px; color: var(--text-dark); border-bottom: 2px solid var(--primary-blue); padding-bottom: 10px; }
        #about-section p, #about-section li { color: var(--text-dark); margin-bottom: 20px; font-size: 1.1rem; line-height: 1.7; }
        #about-section ul, #about-section ol { padding-left: 40px; }
        #about-section strong { color: var(--text-dark); font-weight: 600; }
        .footer { background-color: #212529; color: #ccc; padding: 50px 0 20px; margin-top: 60px; text-align: center; }
        .social-icons { list-style: none; display: flex; justify-content: center; gap: 25px; margin-bottom: 20px; }
        .social-icons a { color: #ccc; font-size: 1.5rem; transition: color 0.3s; }
        .social-icons a:hover { color: white; }
        .footer-bottom { padding-top: 20px; border-top: 1px solid #444; font-size: 0.9rem; }
        .footer-bottom p { margin-bottom: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(-30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @media (max-width: 768px) {
            .hero h1 { font-size: 2.5rem; }
            .ad-banner-top { width: 100%; max-width: 320px; }
            .hamburger { display: block; }
            .nav-menu { position: fixed; left: -100%; top: 0; flex-direction: column; justify-content: center; align-items: center; width: 100%; height: 100vh; background-color: var(--background-white); transition: 0.3s; z-index: 1001; }
            .nav-menu.active { left: 0; }
            .hamburger.active .bar:nth-child(2) { opacity: 0; }
            .hamburger.active .bar:nth-child(1) { transform: translateY(8px) rotate(45deg); }
            .hamburger.active .bar:nth-child(3) { transform: translateY(-8px) rotate(-45deg); }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="header" id="header">
        <nav class="navbar container">
            <a href="#" class="logo">EasyPDF</a>
            <ul class="nav-menu">
                <li class="nav-item"><a href="#" class="nav-link">Home</a></li>
                <li class="nav-item"><a href="#tools-grid" class="nav-link">All Tools</a></li>
                <li class="nav-item"><a href="#about-section" class="nav-link">About</a></li>
                <li class="nav-item">
                    <div class="theme-switch-wrapper">
                        <label class="theme-switch" for="checkbox">
                            <input type="checkbox" id="checkbox" />
                            <div class="slider round"></div>
                        </label>
                    </div>
                </li>
            </ul>
            <div class="hamburger">
                <span class="bar"></span><span class="bar"></span><span class="bar"></span>
            </div>
        </nav>
    </header>

    <main>
        <!-- Hero Section -->
        <section class="hero">
            <div class="container">
                <h1>The Ultimate PDF Toolkit</h1>
                <p>Securely manage, convert, and edit your PDF files for free, right in your browser. No uploads, no sign-ups.</p>
                <a href="#tools-grid" class="cta-button">Explore PDF Tools</a>
            </div>
        </section>

        <!-- Ad Placeholder Script -->
        <div class="ad-placeholder ad-banner-top">
            <!-- PASTE YOUR 728x90 AD CODE (e.g., Google AdSense) HERE -->
            <!-- Example: <script async src="..."></script> -->
            <span>Advertisement (728x90)</span>
        </div>

        <!-- Tools Grid -->
        <section id="tools-section" class="container">
            <h2 style="text-align: center; font-size: 2.5rem; margin-bottom: 40px;">All PDF Tools</h2>
            <div id="tools-grid">
                <!-- Tool cards are dynamically inserted here -->
            </div>
        </section>

        <!-- Article Section -->
        <section id="about-section">
            <div class="container">
                <h2>The EasyPDF Commitment</h2>
                
                <h3>Why Choose EasyPDF?</h3>
                <p>In a digital world, you need tools that are powerful, safe, and easy to use. <strong>EasyPDF</strong> was built to be your go-to solution for everything PDF, and here’s why it stands out:</p>
                <ul>
                    <li><strong>Absolute Privacy:</strong> All tools process your files directly in your browser. Nothing is ever uploaded to our servers, so your data remains 100% private.</li>
                    <li><strong>Completely Free:</strong> No subscriptions, no hidden costs, and no limits. Get unlimited access to all 29 tools, forever.</li>
                    <li><strong>Incredibly Easy:</strong> With a clean design and simple drag-and-drop interface, you can get your work done in seconds, not minutes.</li>
                    <li><strong>No Installation Needed:</strong> Free up your hard drive. <strong>EasyPDF</strong> works on any device with a modern web browser—no software required.</li>
                </ul>
                <a href="#tools-grid" class="cta-button">Try a Tool Now</a>

                <!-- In-Article Ad Placeholder Script -->
                <div class="ad-placeholder ad-in-article">
                    <!-- PASTE YOUR RESPONSIVE IN-ARTICLE AD CODE HERE -->
                    <span>Advertisement</span>
                </div>

                <h3>Frequently Asked Questions (FAQ)</h3>
                <p>We believe in transparency. Here are answers to some common questions about <strong>EasyPDF</strong>.</p>
                <ul>
                    <li><strong>Is EasyPDF really free?</strong><br>Yes, absolutely. All 29 tools on <strong>EasyPDF</strong> are completely free to use without any restrictions or watermarks. Our goal is to provide accessible tools for everyone.</li>
                    <li><strong>How does EasyPDF keep my files secure?</strong><br>Your security is our top priority. Unlike other sites, <strong>EasyPDF</strong> uses client-side technology. This means your files are processed locally on your own computer. They are never sent over the internet or stored on our servers, guaranteeing your privacy.</li>
                </ul>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer id="footer" class="footer">
        <div class="container">
            <ul class="social-icons">
                <li><a href="#" aria-label="Facebook"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"/></svg></a></li>
                <li><a href="#" aria-label="Twitter"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-.424.727-.666 1.581-.666 2.477 0 1.61.82 3.027 2.053 3.863-.764-.024-1.482-.234-2.11-.583v.062c0 2.256 1.605 4.14 3.737 4.568-.39.106-.803.162-1.227.162-.3 0-.593-.028-.877-.082.593 1.85 2.307 3.198 4.352 3.234-1.595 1.25-3.604 1.995-5.786 1.995-.376 0-.747-.022-1.112-.065 2.062 1.323 4.51 2.092 7.14 2.092 8.57 0 13.255-7.098 13.255-13.254 0-.2-.005-.402-.014-.602.91-.658 1.7-1.475 2.323-2.41z"/></svg></a></li>
                <li><a href="#" aria-label="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.98v16h4.98v-8.396c0-2.002.88-3.396 2.791-3.396 1.563 0 2.209 1.054 2.209 3.396v8.396h4.98v-10.177c0-4.018-2.165-5.823-5.262-5.823-2.423 0-3.894 1.339-4.521 2.583v-2.18h-4.98v16z"/></svg></a></li>
            </ul>
             <div class="footer-bottom">
                 <p>All file processing is done in your browser. We do not upload or store your files.</p>
                <p>© 2024 EasyPDF. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Modal for Tools -->
    <div id="tool-modal" class="modal">
        <div class="modal-content-wrapper">
            <div class="modal-content">
                <div class="modal-main">
                    <div class="loader-overlay" id="loader">
                        <div class="spinner"></div>
                        <p id="loader-text">Processing...</p>
                    </div>
                    <div class="modal-header">
                        <h2 id="modal-tool-title">Tool Title</h2>
                        <button class="close-button">×</button>
                    </div>
                    <div class="modal-body">
                        <div id="tool-content">
                            <input type="file" id="file-input" class="file-input" name="file-input"/>
                            <label class="file-drop-area" id="file-drop-area" for="file-input">
                                <h3>Drag & Drop file(s) here</h3>
                                <p>or</p>
                                <span class="file-label-button">Choose Files</span>
                            </label>
                            <p id="file-type-info" style="font-size: 0.8rem; color: var(--text-light); margin-top: 10px; text-align: center;"></p>
                            <ul class="file-list" id="file-list"></ul>
                            <div class="tool-options" id="tool-options"></div>
                            <button class="process-button" id="process-button" disabled>Process</button>
                            <div id="output-area"></div>
                        </div>
                    </div>
                </div>
                <div class="ad-placeholder ad-sidebar-modal">
                    <!-- PASTE YOUR 160x600 VERTICAL AD CODE HERE -->
                    <span>Advertisement (160x600)</span>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Library Configuration ---
        const { PDFDocument, rgb, degrees, StandardFonts } = PDFLib;
        const { pdfjsLib } = window;
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://unpkg.com/pdfjs-dist@2.16.105/build/pdf.worker.min.js`;

        // --- DOM Elements ---
        const toolsGrid = document.getElementById('tools-grid');
        const modal = document.getElementById('tool-modal');
        const closeModalBtn = document.querySelector('.close-button');
        const modalToolTitle = document.getElementById('modal-tool-title');
        const fileDropArea = document.getElementById('file-drop-area');
        const fileInput = document.getElementById('file-input');
        const fileListElem = document.getElementById('file-list');
        const toolOptionsContainer = document.getElementById('tool-options');
        const processBtn = document.getElementById('process-button');
        const outputArea = document.getElementById('output-area');
        const loader = document.getElementById('loader');
        const loaderText = document.getElementById('loader-text');
        const fileTypeInfo = document.getElementById('file-type-info');
        const themeToggle = document.getElementById('checkbox');
        const toolContent = document.getElementById('tool-content');

        // --- App State ---
        let currentToolId = null;
        let selectedFiles = [];
        let organizedPageOrder = [];

        // --- Colorful Tool Palette ---
        const colors = ['#0d6efd', '#6f42c1', '#d63384', '#dc3545', '#fd7e14', '#ffc107', '#198754', '#20c997', '#0dcaf0'];
        const bgColors = ['#e7f0fe', '#f1eaff', '#fae7f3', '#fde8e9', '#fff2e4', '#fff8e1', '#e4f4ea', '#e5f9f4', '#e3f9fe'];
        let colorIndex = 0;

        // --- Tool Definitions (FULL LIST) ---
        const toolImplementations = {
            'pdf-flipbook': {
                title: '3D PDF Flipbook', desc: 'View your PDF as an interactive 3D book.', fileType: '.pdf', new: true, icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" /></svg>`,
                onFileSelect: (file) => {
                    if (!file) return;
                    showLoader('Loading Flipbook...');
                    const fileURL = URL.createObjectURL(file);
                    toolContent.innerHTML = `<div id="flipbook-container"></div>`;
                    modal.classList.add('flipbook-modal');
                    $('#flipbook-container').flipBook({
                        pdf: fileURL,
                        onbookcreated: () => {
                            hideLoader();
                            URL.revokeObjectURL(fileURL);
                        },
                        sound: true
                    });
                }
            },
            'pdf-to-gif': {
                title: 'PDF to GIF', desc: 'Convert your PDF pages into an animated GIF.', fileType: '.pdf', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M7.5 3.75H6A2.25 2.25 0 003.75 6v1.5M16.5 3.75H18A2.25 2.25 0 0120.25 6v1.5m0 9V18A2.25 2.25 0 0118 20.25h-1.5m-9 0H6A2.25 2.25 0 013.75 18v-1.5M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>`,
                options: () => `<label>Delay between frames (ms):</label><input type="number" id="gif-delay" value="500"><label>Page Range (e.g., 1-5):</label><input type="text" id="page-range" placeholder="All pages"><label>Quality (1-30, lower is better):</label><input type="number" id="gif-quality" value="10">`,
                process: async ([file]) => {
                    const delay = parseInt(document.getElementById('gif-delay').value) || 500;
                    const quality = parseInt(document.getElementById('gif-quality').value) || 10;
                    const range = document.getElementById('page-range').value;
                    showLoader('Initializing GIF Encoder...');
                    const gif = new GIF({ workers: 2, quality: quality, workerScript: 'https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.worker.js' });
                    const pdf = await pdfjsLib.getDocument({ data: await file.arrayBuffer() }).promise;
                    const indices = range ? parsePageRanges(range, pdf.numPages) : [...Array(pdf.numPages).keys()];
                    for (const i of indices) {
                        showLoader(`Processing page ${i + 1}/${indices.length}`);
                        const page = await pdf.getPage(i + 1);
                        const viewport = page.getViewport({ scale: 1.0 });
                        const canvas = document.createElement('canvas');
                        canvas.width = viewport.width; canvas.height = viewport.height;
                        await page.render({ canvasContext: canvas.getContext('2d'), viewport }).promise;
                        gif.addFrame(canvas, { delay: delay });
                    }
                    gif.on('finished', function(blob) {
                        createDownloadLink(blob, 'converted.gif', 'image/gif');
                    });
                    showLoader('Rendering GIF...');
                    gif.render();
                }
            },
            'merge-pdf': {
                title: 'Merge PDF', desc: 'Combine multiple PDFs into one document.', fileType: '.pdf', multiple: true, icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 00-1.883 2.542l.857 6a2.25 2.25 0 002.227 1.932H19.05a2.25 2.25 0 002.227-1.932l.857-6a2.25 2.25 0 00-1.883-2.542m-16.5 0A2.25 2.25 0 015.63 8.25h12.74a2.25 2.25 0 012.244 2.542z" /></svg>`,
                process: async (files) => {
                    showLoader('Merging PDFs...');
                    const mergedPdf = await PDFDocument.create();
                    for (const file of files) {
                        const pdf = await PDFDocument.load(await file.arrayBuffer(), { ignoreEncryption: true });
                        const indices = pdf.getPageIndices();
                        const copiedPages = await mergedPdf.copyPages(pdf, indices);
                        copiedPages.forEach(page => mergedPdf.addPage(page));
                    }
                    createDownloadLink(await mergedPdf.save(), 'merged.pdf', 'application/pdf');
                }
            },
            'split-pdf': {
                title: 'Split PDF', desc: 'Extract pages from a PDF file.', fileType: '.pdf', multiple: false, icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M14.25 9.75L16.5 12l-2.25 2.25m-4.5 0L7.5 12l2.25-2.25M6 20.25h12A2.25 2.25 0 0020.25 18V6A2.25 2.25 0 0018 3.75H6A2.25 2.25 0 003.75 6v12A2.25 2.25 0 006 20.25z" /></svg>`,
                options: () => `<label>Pages to extract (e.g., 1-3, 5):</label><input type="text" id="page-range" placeholder="e.g., 1-3, 5, 8">`,
                process: async ([file]) => {
                    const range = document.getElementById('page-range').value;
                    if (!range) return showError('Please specify a page range.');
                    showLoader('Splitting PDF...');
                    const pdfDoc = await PDFDocument.load(await file.arrayBuffer(), { ignoreEncryption: true });
                    const indices = parsePageRanges(range, pdfDoc.getPageCount());
                    if (indices.length === 0) return showError('Invalid page range.');
                    const newPdf = await PDFDocument.create();
                    const copied = await newPdf.copyPages(pdfDoc, indices);
                    copied.forEach(page => newPdf.addPage(page));
                    createDownloadLink(await newPdf.save(), 'split.pdf', 'application/pdf');
                }
            },
            'compress-pdf': {
                title: 'Compress PDF', desc: 'Reduce PDF file size (may lower quality).', fileType: '.pdf', multiple: false, icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25" /></svg>`,
                options: () => `<label>Image Quality (0.1-1.0):</label><input type="range" id="quality-slider" min="0.1" max="1" step="0.1" value="0.7">`,
                process: async ([file]) => {
                    showLoader('Compressing PDF...');
                    const quality = parseFloat(document.getElementById('quality-slider').value);
                    const bytes = await file.arrayBuffer();
                    const pdfjsDoc = await pdfjsLib.getDocument({ data: bytes }).promise;
                    const compressedPdf = await PDFDocument.create();
                    for (let i = 1; i <= pdfjsDoc.numPages; i++) {
                        showLoader(`Processing page ${i}/${pdfjsDoc.numPages}`);
                        const page = await pdfjsDoc.getPage(i);
                        const viewport = page.getViewport({ scale: 1.5 });
                        const canvas = document.createElement('canvas');
                        canvas.width = viewport.width;
                        canvas.height = viewport.height;
                        await page.render({ canvasContext: canvas.getContext('2d'), viewport }).promise;
                        const jpgImg = await compressedPdf.embedJpg(await fetch(canvas.toDataURL('image/jpeg', quality)).then(res => res.arrayBuffer()));
                        const { width, height } = page.getViewport({ scale: 1.0 });
                        const newPage = compressedPdf.addPage([width, height]);
                        newPage.drawImage(jpgImg, { x: 0, y: 0, width, height });
                    }
                    createDownloadLink(await compressedPdf.save(), 'compressed.pdf', 'application/pdf');
                }
            },
            'organize-pdf': {
                title: 'Organize PDF', desc: 'Re-order, rotate, and delete pages.', fileType: '.pdf', multiple: false, icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>`,
                options: () => `<p>Drag and drop pages to reorder. Use the 'x' to delete.</p><div id="organize-pages-grid"></div>`,
                onFileSelect: setupOrganizeUI,
                process: async ([file]) => {
                    showLoader('Organizing PDF...');
                    const pdfDoc = await PDFDocument.load(await file.arrayBuffer(), { ignoreEncryption: true });
                    const newPdf = await PDFDocument.create();
                    const finalIndices = organizedPageOrder.map(id => parseInt(id.split('-')[1]));
                    if (finalIndices.length === 0) return showError("No pages left to save!");
                    const copied = await newPdf.copyPages(pdfDoc, finalIndices);
                    copied.forEach(page => newPdf.addPage(page));
                    createDownloadLink(await newPdf.save(), 'organized.pdf', 'application/pdf');
                }
            },
            'pdf-to-word': { title: 'PDF to Word (.txt)', desc: 'Extract text from PDF to a TXT file.', fileType: '.pdf', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 13.5l3 3m0 0l3-3m-3 3v-6m1.06-4.19l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z" /></svg>`, process: processPdfToText },
            'word-to-pdf': { title: 'Word to PDF', desc: 'Convert DOCX documents to PDF.', fileType: '.docx', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m.75 12l3 3m0 0l3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>`, process: processOfficeToPdf },
            'ppt-to-pdf': { title: 'PowerPoint to PDF', desc: 'Convert PPTX presentations to PDF.', fileType: '.pptx', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 17.25v1.007a3 3 0 01-.879 2.122L7.5 21h9l-1.621-1.621A3 3 0 0115 18.257V17.25m6-12V15a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 15V5.25A2.25 2.25 0 015.25 3h13.5A2.25 2.25 0 0121 5.25z" /></svg>`, process: processOfficeToPdf },
            'excel-to-pdf': { title: 'Excel to PDF', desc: 'Convert Excel sheets to PDF tables.', fileType: '.xlsx, .xls', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.375 19.5h17.25a2.25 2.25 0 002.25-2.25V6.75a2.25 2.25 0 00-2.25-2.25H3.375A2.25 2.25 0 001.125 6.75v10.5a2.25 2.25 0 002.25 2.25zM9 15l-3-3m0 0l3-3m-3 3h12" /></svg>`, process: processOfficeToPdf },
            'pdf-to-jpg': { title: 'PDF to JPG', desc: 'Convert each PDF page to a JPG image.', fileType: '.pdf', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" /></svg>`, process: processPdfToJpg },
            'jpg-to-pdf': { title: 'JPG to PDF', desc: 'Convert JPG images into a single PDF.', fileType: '.jpg, .jpeg', multiple: true, icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z" /></svg>`, process: processImagesToPdf },
            'png-to-pdf': { title: 'PNG to PDF', desc: 'Convert PNG images into a single PDF.', fileType: '.png', multiple: true, icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z" /></svg>`, process: processImagesToPdf },
            'rotate-pdf': { title: 'Rotate PDF', desc: 'Rotate all pages in a PDF document.', fileType: '.pdf', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0011.667 0l3.181-3.183m-4.991-2.691v4.992h-4.992m0 0l-3.181-3.183a8.25 8.25 0 0111.667 0l3.181 3.183" /></svg>`,
                options: () => `<label>Rotation Angle:</label><select id="rotation-angle"><option value="90">90° Clockwise</option><option value="180">180°</option><option value="270">270° Clockwise</option></select>`,
                process: async ([file]) => {
                    showLoader('Rotating PDF...');
                    const angle = parseInt(document.getElementById('rotation-angle').value);
                    const pdfDoc = await PDFDocument.load(await file.arrayBuffer(), { ignoreEncryption: true });
                    pdfDoc.getPages().forEach(p => p.setRotation(degrees(p.getRotation().angle + angle)));
                    createDownloadLink(await pdfDoc.save(), 'rotated.pdf', 'application/pdf');
                }
            },
            'watermark-pdf': { title: 'Watermark PDF', desc: 'Add a text or image watermark.', fileType: '.pdf', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15A2.25 2.25 0 002.25 6.75v10.5A2.25 2.25 0 004.5 21z" /></svg>`,
                options: () => `<label>Watermark Text:</label><input type="text" id="watermark-text" value="CONFIDENTIAL"><label>Opacity (0.1-1.0):</label><input type="range" id="opacity-slider" min="0.1" max="1" step="0.1" value="0.2">`,
                process: async ([file]) => {
                    const text = document.getElementById('watermark-text').value;
                    const opacity = parseFloat(document.getElementById('opacity-slider').value);
                    showLoader('Adding Watermark...');
                    const pdfDoc = await PDFDocument.load(await file.arrayBuffer(), { ignoreEncryption: true });
                    const font = await pdfDoc.embedFont(StandardFonts.HelveticaBold);
                    pdfDoc.getPages().forEach(page => {
                        const { width, height } = page.getSize();
                        page.drawText(text, { x: width / 4, y: height / 2, font, size: 50, color: rgb(0,0,0), opacity });
                    });
                    createDownloadLink(await pdfDoc.save(), 'watermarked.pdf', 'application/pdf');
                }
            },
            'page-numbers': { title: 'Add Page Numbers', desc: 'Insert page numbers into your PDF.', fileType: '.pdf', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25H12" /></svg>`,
                process: async ([file]) => {
                    showLoader('Adding Page Numbers...');
                    const pdfDoc = await PDFDocument.load(await file.arrayBuffer(), { ignoreEncryption: true });
                    const font = await pdfDoc.embedFont(StandardFonts.Helvetica);
                    const pages = pdfDoc.getPages();
                    for(let i=0; i < pages.length; i++) {
                        const { width, height } = pages[i].getSize();
                        pages[i].drawText(`${i+1} / ${pages.length}`, {x: width/2 - 20, y: 30, font, size: 12, color: rgb(0,0,0)})
                    }
                    createDownloadLink(await pdfDoc.save(), 'numbered.pdf', 'application/pdf');
                }
            },
            'protect-pdf': { title: 'Protect PDF', desc: 'Add a password to your PDF file.', fileType: '.pdf', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" /></svg>`,
                options: () => `<label>Set Password:</label><input type="password" id="pdf-password">`,
                process: async ([file]) => {
                    const password = document.getElementById('pdf-password').value;
                    if (!password) return showError('Please enter a password.');
                    showLoader('Protecting PDF...');
                    const pdfDoc = await PDFDocument.load(await file.arrayBuffer(), { ignoreEncryption: true });
                    createDownloadLink(await pdfDoc.save({ userPassword: password }), 'protected.pdf', 'application/pdf');
                }
            },
            'unlock-pdf': { title: 'Unlock PDF', desc: 'Remove a password from a PDF (password required).', fileType: '.pdf', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 10.5V6.75a4.5 4.5 0 119 0v3.75M3.75 10.5V6.75a4.5 4.5 0 10-9 0v3.75m.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" /></svg>`,
                options: () => `<label>Current Password:</label><input type="password" id="pdf-password">`,
                process: async ([file]) => {
                    const password = document.getElementById('pdf-password').value;
                    if (!password) return showError('Please enter the current password.');
                    showLoader('Unlocking PDF...');
                    try {
                        const pdfDoc = await PDFDocument.load(await file.arrayBuffer(), { ownerPassword: password });
                        createDownloadLink(await pdfDoc.save(), 'unlocked.pdf', 'application/pdf');
                    } catch(e) { showError('Incorrect password or file is not encrypted.'); }
                }
            },
            'ocr-pdf': { title: 'OCR PDF', desc: 'Make scanned text selectable (slow process).', fileType: '.pdf, .jpg, .png', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 7.5l3 2.25-3 2.25m4.5 0h3m-9 8.25h13.5A2.25 2.25 0 0021 18V6a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 6v12a2.25 2.25 0 002.25 2.25z" /></svg>`,
                process: async ([file]) => {
                    showLoader('Initializing OCR Engine...');
                    const worker = await Tesseract.createWorker({ logger: m => showLoader(m.status) });
                    showLoader('Recognizing Text...');
                    await worker.recognize(file);
                    showLoader('Creating Searchable PDF...');
                    const { data } = await worker.getPDF('Tesseract OCR Result');
                    await worker.terminate();
                    createDownloadLink(new Uint8Array(data), 'ocr-result.pdf', 'application/pdf');
                }
            },
            'html-to-pdf': { title: 'HTML to PDF', desc: 'Convert HTML code or a URL to PDF.', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5" /></svg>`,
                options: () => `<label>Paste HTML Code:</label><textarea id="html-input" style="height: 150px; width: 100%;"></textarea>`,
                process: async () => {
                    const html = document.getElementById('html-input').value;
                    if(!html) return showError("Please enter some HTML code.");
                    showLoader('Converting HTML to PDF...');
                    html2pdf().from(html).set({ filename: 'converted.pdf' }).save().then(hideLoader);
                }
            },
            'pdf-to-ppt': { title: 'PDF to PowerPoint', desc: 'Convert each PDF page to a PPTX slide.', fileType: '.pdf', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M7.5 7.5h-.75A2.25 2.25 0 004.5 9.75v7.5a2.25 2.25 0 002.25 2.25h7.5a2.25 2.25 0 002.25-2.25v-7.5a2.25 2.25 0 00-2.25-2.25h-.75m-6 3.75l3 3m0 0l3-3m-3 3V1.5m-9 5.25h16.5" /></svg>`,
                process: async ([file]) => {
                    showLoader('Converting to PPTX...');
                    const pptx = new PptxGenJS();
                    const bytes = await file.arrayBuffer();
                    const pdfjsDoc = await pdfjsLib.getDocument({ data: bytes }).promise;
                    for (let i = 1; i <= pdfjsDoc.numPages; i++) {
                        showLoader(`Processing page ${i}/${pdfjsDoc.numPages}`);
                        const page = await pdfjsDoc.getPage(i);
                        const viewport = page.getViewport({ scale: 1.5 });
                        const canvas = document.createElement('canvas');
                        canvas.width = viewport.width; canvas.height = viewport.height;
                        await page.render({ canvasContext: canvas.getContext('2d'), viewport }).promise;
                        pptx.addSlide().addImage({ data: canvas.toDataURL('image/png'), x: 0, y: 0, w: '100%', h: '100%' });
                    }
                    pptx.writeFile({ fileName: 'converted.pptx' }).then(() => hideLoader());
                }
            },
            'repair-pdf': { title: 'Repair PDF', desc: 'Attempt to fix a corrupted PDF file.', fileType: '.pdf', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.456-2.456L12.502 18l1.178-.398a3.375 3.375 0 002.456-2.456L16.5 14.25l.398 1.178a3.375 3.375 0 002.456 2.456l1.178.398-1.178.398a3.375 3.375 0 00-2.456 2.456z" /></svg>`,
                process: async ([file]) => {
                     showLoader('Attempting to repair...');
                    try {
                        const pdfDoc = await PDFDocument.load(await file.arrayBuffer(), { ignoreEncryption: true });
                        createDownloadLink(await pdfDoc.save(), 'repaired.pdf', 'application/pdf');
                    } catch(e) { showError('Could not repair the file. It might be too damaged.'); }
                }
            },
             'pdf-to-text': { title: 'PDF to Text', desc: 'Extract plain text from your PDF.', fileType: '.pdf', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m-1.5 0V3.75c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v1.5m-3 0h3m-3 18.75h3m-3 0v-6m0 6H5.25a2.25 2.25 0 01-2.25-2.25V7.5a2.25 2.25 0 012.25-2.25h13.5a2.25 2.25 0 012.25 2.25v10.5a2.25 2.25 0 01-2.25 2.25H9.75" /></svg>`, process: processPdfToText },
             'pdf-to-html': { title: 'PDF to HTML', desc: 'Convert PDF to a basic HTML file (experimental).', fileType: '.pdf', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M11.25 4.5l7.5 7.5-7.5 7.5m-6-15l7.5 7.5-7.5 7.5" /></svg>`,
                 process: async ([file]) => {
                    alert("This is an experimental feature and may not preserve layout perfectly.");
                    const fullText = await getPdfText(file);
                    const html = `<!DOCTYPE html><html><head><title>${file.name}</title></head><body><pre>${fullText.replace(/</g, "<").replace(/>/g, ">")}</pre></body></html>`;
                    createDownloadLink(new Blob([html], {type: 'text/html'}), 'converted.html', 'text/html');
                }
             },
             'sign-pdf': { title: 'Sign PDF', desc: 'Add your signature to a PDF document.', fileType: '.pdf', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" /></svg>`,
                options: () => `<label>Draw signature below:</label><canvas id="signature-canvas" style="border: 1px solid black; cursor: crosshair;"></canvas><button id="clear-signature" style="margin-top: 5px;">Clear</button>`,
                onFileSelect: () => {
                    const canvas = new fabric.Canvas('signature-canvas', { isDrawingMode: true, width: 400, height: 150 });
                    canvas.freeDrawingBrush.width = 2;
                    document.getElementById('clear-signature').onclick = () => canvas.clear();
                },
                process: async ([file]) => {
                    showLoader('Adding Signature...');
                    const sigCanvas = document.getElementById('signature-canvas');
                    if (sigCanvas.toDataURL() === new fabric.Canvas(null, {width: sigCanvas.width, height: sigCanvas.height}).toDataURL()) return showError('Please draw a signature first.');
                    const pdfDoc = await PDFDocument.load(await file.arrayBuffer(), { ignoreEncryption: true });
                    const sigImage = await pdfDoc.embedPng(sigCanvas.toDataURL());
                    const firstPage = pdfDoc.getPages()[0];
                    firstPage.drawImage(sigImage, { x: 50, y: 50, width: 150, height: 75 });
                    createDownloadLink(await pdfDoc.save(), 'signed.pdf', 'application/pdf');
                }
            },
            'pdf-a': { title: 'PDF/A', desc: 'Convert to PDF/A for archiving.', fileType: '.pdf', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12h-15m0 0l6.75-6.75M4.5 12l6.75 6.75" /></svg>`, process: () => alert('This feature is not yet available.') },
            'redact': { title: 'Redact PDF', desc: 'Permanently black out text.', fileType: '.pdf', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path d="M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`, process: () => alert('This feature is not yet available.') },
            'headers': { title: 'Headers & Footers', desc: 'Add custom headers and footers.', fileType: '.pdf', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5" /><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 8.25l7.5 7.5 7.5-7.5" /></svg>`, process: () => alert('This feature is not yet available.') },
            'flatten': { title: 'Flatten PDF', desc: 'Make annotations and forms uneditable.', fileType: '.pdf', icon: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 4.5h14.25M3 9h9.75M3 13.5h5.25m5.25-.75L17.25 9m0 0L21 12.75M17.25 9v12" /></svg>`, process: () => alert('This feature is not yet available.') },
        };

        // --- Core Functions ---
        const init = () => {
            // Dark Mode Toggle
            themeToggle.addEventListener('change', () => {
                if (themeToggle.checked) {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.documentElement.setAttribute('data-theme', 'light');
                    localStorage.setItem('theme', 'light');
                }
            });
            const currentTheme = localStorage.getItem('theme') ? localStorage.getItem('theme') : null;
            if (currentTheme) {
                document.documentElement.setAttribute('data-theme', currentTheme);
                if (currentTheme === 'dark') {
                    themeToggle.checked = true;
                }
            }

            // Setup UI
            document.querySelector('.hamburger').addEventListener('click', () => {
                document.querySelector('.hamburger').classList.toggle('active');
                document.querySelector('.nav-menu').classList.toggle('active');
            });
            window.addEventListener('scroll', () => document.querySelector('.header').classList.toggle('scrolled', window.scrollY > 50));
            
            // Generate tool cards
            Object.keys(toolImplementations).forEach(id => {
                const tool = toolImplementations[id];
                const card = document.createElement('div');
                card.className = 'tool-card reveal';
                const iconColor = colors[colorIndex % colors.length];
                const bgColor = bgColors[colorIndex % bgColors.length];
                colorIndex++;
                card.innerHTML = `
                    ${tool.new ? '<div class="new-badge">New!</div>' : ''}
                    <div class="icon-wrapper" style="--icon-color: ${iconColor}; --icon-bg-color: ${bgColor};">
                        <div class="icon">${tool.icon}</div>
                    </div>
                    <h3>${tool.title}</h3>
                    <p>${tool.desc}</p>
                `;
                card.addEventListener('click', () => openModal(id));
                toolsGrid.appendChild(card);
            });
            
             // Reveal animations
            const observer = new IntersectionObserver(entries => {
                entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('active') });
            }, { threshold: 0.1 });
            document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
        };

        // Modal and File Handling
        const openModal = (toolId) => {
            const tool = toolImplementations[toolId];
            if (!tool.process && !tool.onFileSelect) return alert('This tool is coming soon!');
            currentToolId = toolId;
            modal.classList.toggle('flipbook-modal', toolId === 'pdf-flipbook');
            modalToolTitle.textContent = tool.title;
            toolOptionsContainer.innerHTML = tool.options ? tool.options() : '';
            fileTypeInfo.textContent = tool.fileType ? `Accepted: ${tool.fileType}` : '';
            fileInput.accept = tool.fileType || '*/*';
            fileInput.multiple = !!tool.multiple;
            resetModal();
            modal.style.display = 'flex';
        };
        const closeModal = () => { modal.style.display = 'none'; resetModal(); };
        const resetModal = () => {
            selectedFiles = [];
            organizedPageOrder = [];
            updateFileList();
            outputArea.innerHTML = '';
            processBtn.style.display = 'block';
            processBtn.disabled = true;
            fileInput.value = '';
            hideLoader();
            modal.classList.remove('flipbook-modal');
            if ($('#flipbook-container').flipBook) {
                $('#flipbook-container').flipBook('destroy');
            }
            // Restore default modal content structure
            toolContent.innerHTML = `
                <input type="file" id="file-input" class="file-input" name="file-input"/>
                <label class="file-drop-area" id="file-drop-area" for="file-input">
                    <h3>Drag & Drop file(s) here</h3>
                    <p>or</p>
                    <span class="file-label-button">Choose Files</span>
                </label>
                <p id="file-type-info" style="font-size: 0.8rem; color: var(--text-light); margin-top: 10px; text-align: center;"></p>
                <ul class="file-list" id="file-list"></ul>
                <div class="tool-options" id="tool-options"></div>
                <button class="process-button" id="process-button" disabled>Process</button>
                <div id="output-area"></div>
            `;
        };
        
        closeModalBtn.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => { if (e.target.classList.contains('modal-content-wrapper')) closeModal(); });
        document.body.addEventListener('dragover', (e) => {
            if (e.target.id === 'file-drop-area') {
                e.target.classList.add('dragover');
            }
        }, true);
        document.body.addEventListener('dragleave', (e) => {
            if (e.target.id === 'file-drop-area') {
                e.target.classList.remove('dragover');
            }
        }, true);
        document.body.addEventListener('drop', (e) => {
            e.preventDefault();
            e.stopPropagation();
            if (e.target.id === 'file-drop-area') {
                e.target.classList.remove('dragover');
                _handleFiles(e.dataTransfer.files);
            }
        }, true);
        fileInput.addEventListener('change', (e) => _handleFiles(e.target.files));

        const _handleFiles = (files) => {
            const tool = toolImplementations[currentToolId];
            if (!tool) return;
            let newFiles = [...files];
            if(tool.fileType) {
                const allowedTypes = tool.fileType.split(',').map(t => t.trim().toLowerCase());
                newFiles = newFiles.filter(f => allowedTypes.some(type => f.name.toLowerCase().endsWith(type)));
            }
            if (tool.multiple) selectedFiles.push(...newFiles);
            else selectedFiles = newFiles.length ? [newFiles[0]] : [];
            updateFileList();
            if (tool.onFileSelect && selectedFiles.length) tool.onFileSelect(selectedFiles[0]);
        };

        const updateFileList = () => {
            const fileListElemDynamic = document.getElementById('file-list');
            const processBtnDynamic = document.getElementById('process-button');
            if (!fileListElemDynamic || !processBtnDynamic) return;

            fileListElemDynamic.innerHTML = '';
            selectedFiles.forEach((file, index) => {
                const li = document.createElement('li');
                li.textContent = file.name;
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-file-btn';
                removeBtn.innerHTML = '×';
                removeBtn.onclick = () => { selectedFiles.splice(index, 1); updateFileList(); };
                li.appendChild(removeBtn);
                fileListElemDynamic.appendChild(li);
            });
            processBtnDynamic.disabled = selectedFiles.length === 0;
            if(currentToolId === 'organize-pdf' && selectedFiles.length === 0) {
                 const grid = document.getElementById('organize-pages-grid');
                 if (grid) grid.innerHTML = '';
            }
        };

        processBtn.addEventListener('click', async () => {
            const tool = toolImplementations[currentToolId];
            if (tool && tool.process) {
                try {
                    await tool.process(selectedFiles);
                } catch (err) {
                    console.error('Processing error:', err);
                    showError(`An error occurred: ${err.message}`);
                }
            }
        });

        // Tool-specific helpers
        const loadingMessages = ["Brewing your PDF...", "Assembling pixels...", "Working some magic...", "Almost there..."];
        const showLoader = (text) => { 
            loaderText.textContent = text || loadingMessages[Math.floor(Math.random() * loadingMessages.length)];
            loader.style.display = 'flex'; 
        };
        const hideLoader = () => { loader.style.display = 'none'; };
        const showError = (msg) => { hideLoader(); alert(msg); };
        const createDownloadLink = (data, filename, type) => {
            hideLoader();
            const outputAreaDynamic = document.getElementById('output-area');
            if (!outputAreaDynamic) return;
            outputAreaDynamic.innerHTML = '';
            const blob = data instanceof Blob ? data : new Blob([data], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.textContent = `Download ${filename}`;
            a.className = 'download-link';
            outputAreaDynamic.appendChild(a);
        };
        const parsePageRanges = (str, max) => {
            const indices = new Set();
            str.replace(/\s/g, '').split(',').forEach(part => {
                if (part.includes('-')) {
                    const [start, end] = part.split('-').map(Number);
                    for (let i = start; i <= end; i++) if (i > 0 && i <= max) indices.add(i - 1);
                } else {
                    const i = Number(part); if (i > 0 && i <= max) indices.add(i - 1);
                }
            });
            return Array.from(indices).sort((a, b) => a - b);
        };
        
        async function getPdfText(file) {
            showLoader('Extracting Text...');
            const pdf = await pdfjsLib.getDocument({ data: await file.arrayBuffer() }).promise;
            let fullText = '';
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const content = await page.getTextContent();
                fullText += content.items.map(item => item.str).join(' ') + '\n';
            }
            return fullText;
        }

        async function processPdfToText([file]) {
            const text = await getPdfText(file);
            createDownloadLink(new Blob([text], {type: 'text/plain'}), 'converted.txt', 'text/plain');
        }

        async function processOfficeToPdf([file]) {
            showLoader('Converting to PDF...');
            const fileName = file.name.toLowerCase();
            if (fileName.endsWith('.docx')) {
                const res = await mammoth.convertToHtml({ arrayBuffer: await file.arrayBuffer() });
                html2pdf().from(res.value).set({ filename: 'converted.pdf' }).save().then(hideLoader);
            } else if(fileName.endsWith('.xlsx') || fileName.endsWith('.xls')) {
                const wb = XLSX.read(await file.arrayBuffer(), {type: 'array'});
                const ws = wb.Sheets[wb.SheetNames[0]];
                const html = XLSX.utils.sheet_to_html(ws);
                html2pdf().from(html).set({filename: 'converted.pdf'}).save().then(hideLoader);
            } else if (fileName.endsWith('.pptx')) {
                 showError("Direct PowerPoint-to-PDF conversion is not supported. Use the 'PDF to PowerPoint' tool to convert pages to images within a PPTX file instead.");
            }
        }
        
        async function processPdfToJpg([file]) {
            showLoader('Converting to JPG...');
            const zip = new JSZip();
            const pdf = await pdfjsLib.getDocument({ data: await file.arrayBuffer() }).promise;
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const viewport = page.getViewport({ scale: 2.0 });
                const canvas = document.createElement('canvas');
                canvas.width = viewport.width; canvas.height = viewport.height;
                await page.render({ canvasContext: canvas.getContext('2d'), viewport }).promise;
                zip.file(`page_${i}.jpg`, canvas.toDataURL('image/jpeg').substring(23), { base64: true });
            }
            const content = await zip.generateAsync({ type: 'blob' });
            createDownloadLink(content, 'images.zip', 'application/zip');
        }

        async function processImagesToPdf(files) {
            showLoader('Creating PDF from Images...');
            const pdfDoc = await PDFDocument.create();
            for (const file of files) {
                const bytes = await file.arrayBuffer();
                const image = file.name.toLowerCase().endsWith('.png') ? await pdfDoc.embedPng(bytes) : await pdfDoc.embedJpg(bytes);
                const page = pdfDoc.addPage([image.width, image.height]);
                page.drawImage(image, { x: 0, y: 0, width: image.width, height: image.height });
            }
            createDownloadLink(await pdfDoc.save(), 'images.pdf', 'application/pdf');
        }

        async function setupOrganizeUI(file) {
            if (!file) return;
            const grid = document.getElementById('organize-pages-grid');
            if (!grid) return;
            grid.innerHTML = ''; // Clear previous
            showLoader('Loading pages...');
            const pdf = await pdfjsLib.getDocument({ data: await file.arrayBuffer() }).promise;
            organizedPageOrder = [];
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const viewport = page.getViewport({ scale: 0.3 });
                const canvas = document.createElement('canvas');
                canvas.width = viewport.width; canvas.height = viewport.height;
                await page.render({ canvasContext: canvas.getContext('2d'), viewport }).promise;
                const pageId = `page-${i-1}`;
                organizedPageOrder.push(pageId);
                const item = document.createElement('div');
                item.className = 'organize-page-item';
                item.id = pageId;
                item.innerHTML = `<canvas></canvas><div class="page-number">${i}</div><button class="delete-page-btn">×</button>`;
                item.querySelector('canvas').getContext('2d').drawImage(canvas, 0, 0);
                item.querySelector('.delete-page-btn').onclick = (e) => {
                    e.stopPropagation();
                    const indexToRemove = organizedPageOrder.indexOf(pageId);
                    if (indexToRemove > -1) organizedPageOrder.splice(indexToRemove, 1);
                    item.remove();
                };
                grid.appendChild(item);
            }
            new Sortable(grid, {
                animation: 150,
                onEnd: (evt) => { organizedPageOrder = Array.from(evt.to.children).map(el => el.id); }
            });
            hideLoader();
        }

        init();
    });
    </script>

</body>
</html>
