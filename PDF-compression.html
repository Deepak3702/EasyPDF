<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Free online PDF compressor tool. Reduce PDF file size while maintaining quality. Fast, secure, and easy to use.">
    <meta name="keywords" content="PDF compressor, reduce PDF size, PDF optimizer, shrink PDF, PDF tools">
    <meta name="author" content="EasyPDF">
    <title>PDF Compressor - Reduce PDF File Size Online | EasyPDF</title>
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-YOUR_PUBLISHER_ID" crossorigin="anonymous"></script>
    
    <!-- Favicon -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.worker.min.js';</script>
    
    <style>
        /* [Previous CSS remains exactly the same] */
    </style>
</head>
<body>
    <!-- [Previous HTML structure remains exactly the same until the script section] -->

    <script>
        // DOM Elements
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const selectFileBtn = document.getElementById('selectFileBtn');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const removeFileBtn = document.getElementById('removeFileBtn');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const compressBtn = document.getElementById('compressBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const progressPercent = document.getElementById('progressPercent');
        const progressStatus = document.getElementById('progressStatus');
        const results = document.getElementById('results');
        const originalSize = document.getElementById('originalSize');
        const compressedSize = document.getElementById('compressedSize');
        const reductionPercent = document.getElementById('reductionPercent');
        const downloadBtn = document.getElementById('downloadBtn');
        const newFileBtn = document.getElementById('newFileBtn');
        const verticalAd = document.getElementById('verticalAd');
        
        // Variables
        let currentFile = null;
        let compressedFile = null;
        
        // Event Listeners
        selectFileBtn.addEventListener('click', () => fileInput.click());
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = 'var(--primary)';
            uploadArea.style.backgroundColor = 'rgba(74, 107, 223, 0.1)';
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = '#ddd';
            uploadArea.style.backgroundColor = 'transparent';
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#ddd';
            uploadArea.style.backgroundColor = 'transparent';
            
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                handleFileSelection();
            }
        });
        
        fileInput.addEventListener('change', handleFileSelection);
        removeFileBtn.addEventListener('click', resetTool);
        compressBtn.addEventListener('click', compressPDF);
        downloadBtn.addEventListener('click', downloadPDF);
        newFileBtn.addEventListener('click', resetTool);
        
        // Functions
        function handleFileSelection() {
            const file = fileInput.files[0];
            
            // Hide any previous errors
            hideError();
            
            if (!file) return;
            
            // Validate file type
            if (!file.name.toLowerCase().endsWith('.pdf')) {
                showError('Please select a valid PDF file.');
                fileInput.value = '';
                return;
            }
            
            // Validate file size (max 50MB)
            if (file.size > 50 * 1024 * 1024) {
                showError('File size exceeds 50MB limit. Please choose a smaller file.');
                fileInput.value = '';
                return;
            }
            
            // Store the file
            currentFile = file;
            
            // Show file info
            fileName.textContent = file.name.length > 30 
                ? file.name.substring(0, 27) + '...' 
                : file.name;
            fileSize.textContent = formatFileSize(file.size);
            fileInfo.classList.add('active');
            
            // Enable compress button
            compressBtn.style.display = 'block';
            compressBtn.disabled = false;
            
            // Hide results if previously shown
            results.classList.remove('active');
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.add('active');
        }
        
        function hideError() {
            errorMessage.classList.remove('active');
        }
        
        function resetTool() {
            // Reset file input
            fileInput.value = '';
            currentFile = null;
            compressedFile = null;
            
            // Hide file info and results
            fileInfo.classList.remove('active');
            results.classList.remove('active');
            
            // Hide compress button
            compressBtn.style.display = 'none';
            
            // Reset progress
            progressContainer.classList.remove('active');
            progressBar.style.width = '0%';
            progressPercent.textContent = '0%';
            
            // Hide any errors
            hideError();
        }
        
        async function compressPDF() {
            if (!currentFile) return;
            
            // Show progress bar
            progressContainer.classList.add('active');
            compressBtn.disabled = true;
            
            try {
                // Get selected compression level
                const compressionLevel = document.querySelector('input[name="compression"]:checked').value;
                
                // Read the file as array buffer
                const arrayBuffer = await readFileAsArrayBuffer(currentFile);
                progressStatus.textContent = 'Loading PDF...';
                progressBar.style.width = '10%';
                progressPercent.textContent = '10%';
                
                // Load the PDF document
                const loadingTask = pdfjsLib.getDocument(arrayBuffer);
                const pdf = await loadingTask.promise;
                
                progressStatus.textContent = 'Processing pages...';
                progressBar.style.width = '30%';
                progressPercent.textContent = '30%';
                
                // Create a new PDF document
                const { PDFDocument, rgb } = await import('https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js');
                const newPdfDoc = await PDFDocument.create();
                
                // Copy pages from original to new document with compression
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const viewport = page.getViewport({ scale: 1.0 });
                    
                    // Get the page as an image (simplified approach)
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    
                    await page.render({
                        canvasContext: context,
                        viewport: viewport
                    }).promise;
                    
                    // Add the page to the new document
                    const pageImage = await newPdfDoc.embedPng(canvas.toDataURL('image/png', getQualityForLevel(compressionLevel)));
                    const newPage = newPdfDoc.addPage([viewport.width, viewport.height]);
                    newPage.drawImage(pageImage, {
                        x: 0,
                        y: 0,
                        width: viewport.width,
                        height: viewport.height,
                    });
                    
                    // Update progress
                    const progress = 30 + Math.floor((i / pdf.numPages) * 60);
                    progressBar.style.width = `${progress}%`;
                    progressPercent.textContent = `${progress}%`;
                    progressStatus.textContent = `Processing page ${i} of ${pdf.numPages}...`;
                }
                
                progressStatus.textContent = 'Finalizing compression...';
                progressBar.style.width = '95%';
                progressPercent.textContent = '95%';
                
                // Save the compressed PDF
                const compressedPdfBytes = await newPdfDoc.save();
                
                progressBar.style.width = '100%';
                progressPercent.textContent = '100%';
                progressStatus.textContent = 'Compression complete!';
                
                // Create the compressed file object
                compressedFile = {
                    name: currentFile.name.replace('.pdf', '') + '_compressed.pdf',
                    size: compressedPdfBytes.byteLength,
                    data: compressedPdfBytes
                };
                
                // Show results
                const originalMB = currentFile.size / (1024 * 1024);
                const compressedMB = compressedFile.size / (1024 * 1024);
                showResults(originalMB, compressedMB);
                
            } catch (error) {
                console.error('PDF compression failed:', error);
                showError('Failed to compress PDF. Please try another file.');
                progressContainer.classList.remove('active');
                compressBtn.disabled = false;
            }
        }
        
        function getQualityForLevel(level) {
            switch(level) {
                case 'low': return 0.9;
                case 'medium': return 0.7;
                case 'high': return 0.5;
                default: return 0.7;
            }
        }
        
        function readFileAsArrayBuffer(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }
        
        function showResults(originalMB, compressedMB) {
            const reduction = ((originalMB - compressedMB) / originalMB) * 100;
            
            originalSize.textContent = originalMB.toFixed(2) + ' MB';
            compressedSize.textContent = compressedMB.toFixed(2) + ' MB';
            reductionPercent.textContent = reduction.toFixed(0) + '%';
            
            results.classList.add('active');
            
            // Scroll to results
            results.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        function downloadPDF() {
            if (!compressedFile || !compressedFile.data) return;
            
            // Create a blob URL for the compressed file
            const blob = new Blob([compressedFile.data], { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);
            
            // Create a temporary anchor element
            const a = document.createElement('a');
            a.href = url;
            a.download = compressedFile.name;
            document.body.appendChild(a);
            a.click();
            
            // Clean up
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
        }
        
        // Mobile menu toggle
        const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
        const navLinks = document.querySelector('.nav-links');
        
        mobileMenuBtn.addEventListener('click', () => {
            navLinks.classList.toggle('active');
        });
    </script>
</body>
</html>
